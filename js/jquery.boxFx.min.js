//////////////////////////////////////////////////////////////////////////////////////////
// jQuery.boxFx.js (Beta V0.94) is like a "DOM particles emitter" factory
// "Clash the DOM with the most optimized jQuery animations framework on earth" ^^
// GPL/MIT/Copyleft @molokoloco 28/10/2011 - http://b2bweb.fr
// Sources : https://github.com/molokoloco/jQuery.boxFx/
// Download : https://github.com/molokoloco/jQuery.boxFx/downloads/
/////////////////////////////////////////////////////////////////////////////////////////

(function(b,c){"object"!=typeof Modernizr&&alert('$.fn.boxFx require "./js/modernizr(.min).js"');b.toolsLoaded||alert('$.fn.boxFx require "./js/jquery.tools.js"');Modernizr.csstransitions||db("Sad, your old browser don't support CSS transition ^^");Modernizr.csstransforms3d||db("Sad, your old computer don't support CSS 3D");b.boxFxOptions={seeds:"<div/>",targets:null,data:null,styles2Class:!0,clss:null,effect:null,emitterRadius:0,emitterCenterLeft:null,emitterCenterTop:null,delay:null,maxSeeds:null,
newAtTop:"random",stopAtEnd:null,styles:null,transition:null,keyframes:null};b.boxFxOptions.defaultStyles={position:"absolute",display:"block",zIndex:500,width:50,height:50,backgroundColor:"rgb(255, 255, 0)"};b.boxFxOptions.defaultTransition={properties:"all",duration:"2500ms",timingFunction:"ease",stylesTo:null};b.boxFxOptions.defaultKeyframes=[{name:null,duration:"3000ms",timingFunction:"ease",delay:0,iterationCount:"infinite",direction:"alternate",fillMode:"both",steps:[]}];b.fn.boxFx=function(a){a=
b.extend(!0,{},b.boxFxOptions,a);return this.each(function(){var i=b(this),d,y,w,x,l,s,t,j,m,f,e,h,n,o,p,q,r,z,v={start:function(){u.initFx();u.configSetupFix();v.play()},play:function(){setTimeout(function(){if(a.keyframes)for(var b=c[d].length;b--;)c[d][b]&&0<c[d][b].length&&c[d][b].crossCss({animationPlayState:"running"});y=!0;v.newSeed()},0)},newSeed:function(){A()},pause:function(){if(a.keyframes)for(var b=c[d].length;b--;)c[d][b]&&0<c[d][b].length&&c[d][b].crossCss({animationPlayState:"paused"})},
stop:function(){y=!1;w&&clearTimeout(w);w=null;v.pause()},reset:function(){v.stop();for(var g=c[d].length;g--;)a.targets?(c[d][g].html(b.data(c[d][g],"template")).removeData(),b.contains(c[d][g],i)||c[d][g].appendTo(i)):c[d][g]&&0<c[d][g].length&&c[d][g].empty().remove(),delete c[d][g];delete c[d]},update:function(g,c){c&&!b.isEmptyObject(c)&&(a=b.extend(!0,{},a,c),u.configSetupFix())},setOptions:function(g,c){c&&!b.isEmptyObject(c)&&(v.reset(),setTimeout(function(){a=b.extend(!0,{},b.boxFxOptions,
c);v.start()},0))}},u={initFx:function(){d=void 0;y=void 0;w=void 0;x=void 0;l=void 0;s=void 0;t=void 0;j=void 0;m=void 0;f=void 0;e=void 0;h=void 0;n=void 0;o=void 0;p=void 0;q=void 0;r=void 0;z=void 0;y=!0;w=null;d=b.getUniqueName("boxFx");x=0;l=null;t=s=0;c[d]=[];a.targets&&b(a.targets).each(function(g){c[d][g]=b(this).detach();!a.template&&a.data&&(b.data(c[d][g],"template",c[d][g].html()),c[d][g].html(""))})},configSetupFix:function(){j=parseInt(i.width(),10);m=parseInt(i.height(),10);if(a.keyframes)b.each(a.keyframes,
function(c,d){b.each(d.steps,function(d,k){b.each(k,function(b,k){"function"==typeof k&&(a.keyframes[c].steps[d][b]=a.keyframes[c].steps[d][b]())})})}),a.keyframes=b.extend(!0,{},a.defaultKeyframes,a.keyframes),a.animationsClss=b.buildKeyframeClass(a.keyframes);if(a.seeds&&!a.template&&a.data)a.template=b(a.seeds).html(),b(a.seeds).html("");if(!a.styles&&!a.clss)a.styles=b.extend({},a.defaultStyles);a.styles&&b.removeObjEmptyValue(a.styles);if(a.effect){if(!a.styles)a.styles={};if(!a.styles.zIndex&&
0!==a.styles.zIndex)a.styles.zIndex=a.defaultStyles.zIndex;if(!a.styles.position)a.styles.position="absolute"}if(a.effect&&!a.transition)a.transition={};if(a.transition){a.transition=b.extend(!0,{},a.defaultTransition,a.transition);if(!a.transition.stylesTo)a.transition.stylesTo={};a.transition.stylesTo.transition=a.transition.properties+" "+a.transition.duration+" "+a.transition.timingFunction}a.stopAtEnd=a.transition&&!a.effect&&!1!==a.stopAtEnd?!0:!1;a.transition&&a.transition.duration&&(s=parseInt(a.transition.duration,
10),"ms"!=a.transition.duration.substr(-2)&&(s*=1E3));a.keyframes&&a.keyframes[0].duration&&(t=parseInt(a.keyframes[0].duration,10),"ms"!=a.keyframes[0].duration.substr(-2)&&(t*=1E3));if(!a.delay&&0!==a.delay)a.delay=s>t?s:t;if(a.targets)l=b(a.targets).hide(),a.maxSeeds=l.length;else if(!a.maxSeeds&&a.data&&"function"!=typeof a.data&&a.data.length)a.maxSeeds=a.data.length;else if(!a.maxSeeds&&a.transition)a.maxSeeds=1>a.delay?parseFloat(a.transition.duration):parseFloat(a.transition.duration)/a.delay;
if(1>a.maxSeeds)a.maxSeeds=1;else if(1E3<a.maxSeeds)a.maxSeeds=1E3;a.styles&&b.fixCssUnit(a.styles,j,m);a.transition&&a.transition.stylesTo&&b.fixCssUnit(a.transition.stylesTo,j,m);if(a.emitterRadius)a.emitterRadius=b.getSize(a.emitterRadius,j);a.emitterCenterLeft=!a.emitterCenterLeft&&0!==a.emitterCenterLeft?j/2:b.getSize(a.emitterCenterLeft,j);a.emitterCenterTop=!a.emitterCenterTop&&0!==a.emitterCenterTop?m/2:b.getSize(a.emitterCenterTop,m)},getCssStart:function(){if(l&&0<l.length){if(!a.styles.width&&
0!==a.styles.width)a.styles.width=parseInt(l.eq(f||0).width(),10);if(!a.styles.height&&0!==a.styles.height)a.styles.height=parseInt(l.eq(f||0).height(),10)}if(!a.effect&&a.styles)return b.extend({},a.styles);if(!a.styles.width&&0!==a.styles.width)db("Config. error, need at least options.styles.width to be setted"),a.styles.width=a.styles.height=0;var c,d,e;c=a.styles.maxSize||0===a.styles.maxSize?b.getRand(a.styles.width,a.styles.maxSize):a.styles.width;d=a.styles.height||0===a.styles.height?a.styles.maxSize||
0===a.styles.maxSize?b.getRand(a.styles.height,a.styles.maxSize):a.styles.height:c;e="random"==a.newAtTop?b.getRand(a.styles.zIndex,a.styles.zIndex+a.maxSeeds):a.newAtTop?a.styles.zIndex++:a.styles.zIndex--;return b.extend({},a.styles,{zIndex:e,width:c,height:d})},getCssEnd:function(c){if(!a.transition||!a.transition.stylesTo)return{};if(!a.effect)return b.extend({},a.transition.stylesTo);var d;d=c.width;c=c.height;if(a.transition.stylesTo.width||0===a.transition.stylesTo.width)c=d=a.transition.stylesTo.maxSize||
0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.width,a.transition.stylesTo.maxSize):a.transition.stylesTo.width;if(a.transition.stylesTo.height||0===a.transition.stylesTo.height)c=a.transition.stylesTo.maxSize||0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.height,a.transition.stylesTo.maxSize):a.transition.stylesTo.height;return b.extend({},a.transition.stylesTo,{width:d,height:c})},applyCssStart:function(d,k,e){a.clss&&c[d][k].addClass(a.clss);e&&(b.addCssUnit(e),
c[d][k].crossCss(e));"none"==c[d][k].css("display")&&c[d][k].css({display:""});a.animationsClss&&c[d][k].crossCss(a.animationsClss)},applyCssEnd:function(d,e,f){d&&d in c&&e in c[d]&&(a.clssTo&&c[d][e].addClass(a.clssTo),f&&(b.addCssUnit(f),c[d][e].crossCss(f)),c[d][e].bind(b.transitionEnd,function(){if(d&&!(!d in c||!e in c[d]))c[d][e].unbind(b.transitionEnd),a.stopAtEnd||(b.data(c[d][e],"animated",0),c[d][e].detach(),c[d][e].attr("style",""),a.clss&&c[d][e].removeClass(a.clss),a.clssTo&&c[d][e].removeClass(a.clssTo),
a.animationsClss&&c[d][e].removeClass(a.animationsClss))}))}},A=function(){if(y){f=-1;for(var g=0;g<a.maxSeeds;g++)if(!c[d][g]||!b.data(c[d][g],"animated")){f=g;break}if(0<=f){e=u.getCssStart();h=u.getCssEnd(e);a.styles&&b.each(a.styles,function(b,c){c&&"function"==typeof c&&(e[b]=a.styles[b](f))});a.transition&&a.transition.stylesTo&&b.each(a.transition.stylesTo,function(b,c){c&&"function"==typeof c&&(h[b]=a.transition.stylesTo[b](f))});switch(a.effect){case "center":e.left=a.emitterCenterLeft;e.top=
a.emitterCenterTop;e.marginLeft=-(e.width/2)+b.getRand(-a.emitterRadius,a.emitterRadius);e.marginTop=-(e.height/2)+b.getRand(-a.emitterRadius,a.emitterRadius);h.marginLeft=-h.width/2;h.marginTop=-h.height/2;break;case "artifice":e.left=a.emitterCenterLeft;e.top=a.emitterCenterTop;e.marginLeft=-(parseInt(e.width,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);e.marginTop=-(parseInt(e.height,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);n=-a.emitterCenterLeft;o=-a.emitterCenterTop;p=j-a.emitterCenterLeft-
parseInt(h.width,10);q=m-a.emitterCenterTop-parseInt(h.height,10);0.5<Math.random()?(h.marginLeft=b.getRand(n,p),h.marginTop=0.5>Math.random()?o:q):(h.marginLeft=0.5>Math.random()?n:p,h.marginTop=b.getRand(o,q));break;case "nebula":e.left=a.emitterCenterLeft,e.top=a.emitterCenterTop,e.marginLeft=-(e.width/2)+b.getRand(-a.emitterRadius,a.emitterRadius),e.marginTop=-(e.height/2)+b.getRand(-a.emitterRadius,a.emitterRadius),n=-a.emitterCenterLeft-h.width,o=-a.emitterCenterTop-h.height,p=j-a.emitterCenterLeft,
q=m-a.emitterCenterTop,0.5<Math.random()?(h.marginLeft=b.getRand(n,p),h.marginTop=0.5>Math.random()?o:q):(h.marginLeft=0.5>Math.random()?n:p,h.marginTop=b.getRand(o,q))}if(!c[d][f]||1>c[d][f].length)c[d][f]=b(a.seeds);if(r=a.template?a.template:b.data(c[d][f],"template"))"function"==typeof a.data?b.when(a.data({seed:c[d][f],template:r})).done(function(a,c){a.seed.html(b.getTpl(a.template,c))}):(a.data&&a.data.length&&(z=a.data[x],x<a.data.length-1?x++:x=0),r=z?b.getTpl(r,z):r,c[d][f].html(r));u.applyCssStart(d,
f,e);c[d][f].appendTo(i);b.data(c[d][f],"animated",1);setTimeout(u.applyCssEnd,0,d,f,h);i.trigger("emit",[c[d][f]])}f=void 0;e=void 0;h=void 0;n=void 0;o=void 0;p=void 0;q=void 0;r=void 0;z=void 0;a.stopAtEnd&&f==a.maxSeeds-1||(a.delay?w=setTimeout(A,a.delay):c.requestAnimFrame(A))}};i.bind(v);i.trigger("start");return i})}})(jQuery,window);