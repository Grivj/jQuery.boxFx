//////////////////////////////////////////////////////////////////////////////////////////
// jQuery.boxFx.js (Beta V0.94) is like a "DOM particles emitter" factory
// "Clash the DOM with the most optimized jQuery animations framework on earth" ^^
// GPL/MIT/Copyleft @molokoloco 28/10/2011 - http://b2bweb.fr
// Sources : https://github.com/molokoloco/jQuery.boxFx/
// Download : https://github.com/molokoloco/jQuery.boxFx/downloads/
/////////////////////////////////////////////////////////////////////////////////////////

(function(b,u,C){"object"!=typeof u&&alert('$.fn.boxFx require "./js/modernizr(.min).js"');u.csstransitions||console.log("Sad, your old browser don't support CSS transition");u.csstransforms3d||console.log("Sad, your computer don't support CSS 3D");var i=!!("console"in C)&&!1;b.boxFxOptions={seeds:"<div/>",targets:null,data:null,styles2Class:!0,clss:null,effect:null,emitterRadius:0,emitterCenterLeft:null,emitterCenterTop:null,delay:null,maxSeeds:null,newAtTop:"random",stopAtEnd:!1,styles:null,transition:null,
keyframes:null};b.boxFxOptions.defaultStyles={position:"absolute",display:"block",zIndex:500,width:50,height:50,backgroundColor:"rgb(255, 255, 0)"};b.boxFxOptions.defaultTransition={properties:"all",duration:"2500ms",timingFunction:"ease",stylesTo:null};b.boxFxOptions.defaultKeyframes=[{name:null,duration:"3000ms",timingFunction:"ease",delay:0,iterationCount:"infinite",direction:"alternate",fillMode:"both",steps:[]}];b.boxFxSeeds={};b.fn.boxFx=function(a){i&&console.log("$.fn.boxFx(options)",a);a=
b.extend(!0,{},b.boxFxOptions,a);return this.each(function(){var k=b(this),d,x,m,w,n,y,z,l,o,f,g,h,p,q,r,s,t,A,v={start:function(){i&&console.log("$.boxFx.trigger.start()");j.initFx();j.configSetupFix();v.play()},play:function(){i&&console.log("$.boxFx.trigger.play()");setTimeout(function(){if(a.keyframes&&d in b.boxFxSeeds)for(var c=b.boxFxSeeds[d].length;c--;)b.boxFxSeeds[d][c]&&0<b.boxFxSeeds[d][c].length&&b.boxFxSeeds[d][c].crossCss({animationPlayState:"running"});x=!0;v.newSeed()},0)},newSeed:function(){i&&
console.log("$.boxFx.trigger.newSeed()");u()},pause:function(){i&&console.log("$.boxFx.trigger.pause()");if(a.keyframes&&d in b.boxFxSeeds)for(var c=b.boxFxSeeds[d].length;c--;)b.boxFxSeeds[d][c]&&0<b.boxFxSeeds[d][c].length&&b.boxFxSeeds[d][c].crossCss({animationPlayState:"paused"})},stop:function(){i&&console.log("$.boxFx.trigger.stop()");x=!1;m&&clearTimeout(m);m=null;v.pause()},reset:function(){i&&console.log("$.boxFx.trigger.reset()");v.stop();if(d in b.boxFxSeeds){for(var c=b.boxFxSeeds[d].length;c--;)a.targets?
(b.boxFxSeeds[d][c].html(b.data(b.boxFxSeeds[d][c],"template")).removeData(),b.contains(b.boxFxSeeds[d][c],k)||b.boxFxSeeds[d][c].appendTo(k)):b.boxFxSeeds[d][c]&&0<b.boxFxSeeds[d][c].length&&b.boxFxSeeds[d][c].empty().remove(),delete b.boxFxSeeds[d][c];delete b.boxFxSeeds[d]}},update:function(c,e){i&&console.log("$.boxFx.trigger.update()",e);e&&!b.isEmptyObject(e)&&(a=b.extend(!0,{},a,e),j.configSetupFix())},setOptions:function(c,e){i&&console.log("$.boxFx.trigger.setOptions()",e);e&&!b.isEmptyObject(e)&&
(v.reset(),setTimeout(function(){a=b.extend(!0,{},b.boxFxOptions,e);v.start()},0))},getSeeds:function(){return b.boxFxSeeds[d]}},j={initFx:function(){i&&console.log("initFx()");A=t=s=r=q=p=h=g=f=o=l=z=y=n=w=m=x=d=void 0;x=!0;m=null;d=b.getUniqueName("boxFx");w=0;n=null;z=y=0;b.boxFxSeeds[d]=[];a.targets&&b(a.targets).each(function(c){b.boxFxSeeds[d][c]=b(this).detach();!a.template&&a.data&&(b.data(b.boxFxSeeds[d][c],"template",b.boxFxSeeds[d][c].html()),b.boxFxSeeds[d][c].html(""))})},configSetupFix:function(){i&&
console.log("configSetupFix()",a);l=parseInt(k.width(),10);o=parseInt(k.height(),10);a.keyframes&&(b.each(a.keyframes,function(c,d){b.each(d.steps,function(d,B){b.each(B,function(b,B){"function"==typeof B&&(a.keyframes[c].steps[d][b]=a.keyframes[c].steps[d][b].call())})})}),a.keyframes=b.extend(!0,{},a.defaultKeyframes,a.keyframes),a.animationsClss=b.buildKeyframeClass(a.keyframes));a.seeds&&(!a.template&&a.data)&&(a.template=b(a.seeds).html(),b(a.seeds).html(""));!a.styles&&!a.clss&&(a.styles=b.extend({},
a.defaultStyles));a.styles&&b.removeObjEmptyValue(a.styles);!a.clss&&a.seeds?a.clss=b(a.seeds).attr("class"):a.clss||(a.clss=b(a.targets).eq(0).attr("class"));if(a.effect&&(a.styles||(a.styles={}),!a.styles.zIndex&&0!==a.styles.zIndex&&(a.styles.zIndex=a.defaultStyles.zIndex),a.styles.position||(a.styles.position="absolute"),!a.styles.width&&!a.targets)){var c=b(a.seed).css(a.styles).addClass(a.clss).appendTo(k);a.styles.width=c.width();c.remove()}a.effect&&!a.transition&&(a.transition={});if(a.transition){a.transition=
b.extend(!0,{},a.defaultTransition,a.transition);if(!a.transition||!a.transition.stylesTo)a.transition.stylesTo={};a.transition.stylesTo.transition=a.transition.properties+" "+a.transition.duration+" "+a.transition.timingFunction}a.transition&&(!a.effect&&!a.maxSeeds)&&(a.stopAtEnd=!0);a.transition&&a.transition.duration&&(y=b.getMsDuration(a.transition.duration));a.keyframes&&a.keyframes[0].duration&&(z=b.getMsDuration(a.keyframes[0].duration));!a.delay&&0!==a.delay&&(a.delay=y>z?y:z);a.animationIntroDuration=
0;a.animationOutroDuration=0;a.clss&&(c=b("<div/>").addClass(a.clss).appendTo("body"),a.animationIntroDuration=b.getMsDuration(c.css("-"+b.browserPrefix+"-animation-duration")),a.transition&&a.transition.clssTo&&(c.removeClass(a.clss).addClass(a.transition.clssTo),a.animationOutroDuration=b.getMsDuration(c.css("-"+b.browserPrefix+"-animation-duration"))),c.remove());a.targets?(n=b(a.targets).hide(),a.maxSeeds=n.length):!a.maxSeeds&&a.data&&"function"!=typeof a.data&&a.data.length?a.maxSeeds=a.data.length:
!a.maxSeeds&&a.transition&&(a.maxSeeds=1>a.delay?parseFloat(a.transition.duration):parseFloat(a.transition.duration)/a.delay);!a.maxSeeds||1>a.maxSeeds?a.maxSeeds=1:1E3<a.maxSeeds&&(a.maxSeeds=1E3);a.styles&&b.fixCssUnit(a.styles,l,o);a.transition&&a.transition.stylesTo&&b.fixCssUnit(a.transition.stylesTo,l,o);a.emitterRadius&&(a.emitterRadius=b.getSize(a.emitterRadius,l));a.emitterCenterLeft=!a.emitterCenterLeft&&0!==a.emitterCenterLeft?l/2:b.getSize(a.emitterCenterLeft,l);a.emitterCenterTop=!a.emitterCenterTop&&
0!==a.emitterCenterTop?o/2:b.getSize(a.emitterCenterTop,o)},getCssStart:function(){if(n&&0<n.length&&(!a.styles.width&&0!==a.styles.width&&(a.styles.width=parseInt(n.eq(f||0).width(),10)),!a.styles.height&&0!==a.styles.height))a.styles.height=parseInt(n.eq(f||0).height(),10);if(!a.effect&&a.styles)return b.extend({},a.styles);!a.styles.width&&0!==a.styles.width&&(console.log("Config. error, need at least options.styles.width to be setted"),a.styles.width=a.styles.height=0);var c,e,d;c=a.styles.maxSize||
0===a.styles.maxSize?b.getRand(a.styles.width,a.styles.maxSize):a.styles.width;e=a.styles.height||0===a.styles.height?a.styles.maxSize||0===a.styles.maxSize?b.getRand(a.styles.height,a.styles.maxSize):a.styles.height:c;d="random"==a.newAtTop?b.getRand(a.styles.zIndex,a.styles.zIndex+a.maxSeeds):a.newAtTop?a.styles.zIndex++:a.styles.zIndex--;return b.extend({},a.styles,{zIndex:d,width:c,height:e})},getCssEnd:function(c){if(!a.transition||!a.transition.stylesTo)return{};if(!a.effect)return b.extend({},
a.transition.stylesTo);var e;e=c.width;c=c.height;if(a.transition.stylesTo.width||0===a.transition.stylesTo.width)c=e=a.transition.stylesTo.maxSize||0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.width,a.transition.stylesTo.maxSize):a.transition.stylesTo.width;if(a.transition.stylesTo.height||0===a.transition.stylesTo.height)c=a.transition.stylesTo.maxSize||0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.height,a.transition.stylesTo.maxSize):a.transition.stylesTo.height;
return b.extend({},a.transition.stylesTo,{width:e,height:c})},applyCssStart:function(c,e,d){d&&(b.addCssUnit(d),b.boxFxSeeds[c][e].crossCss(d));a.clss&&b.boxFxSeeds[c][e].addClass(a.clss);a.animationsClss&&b.boxFxSeeds[c][e].crossCss(a.animationsClss);"none"==b.boxFxSeeds[c][e].css("display")&&b.boxFxSeeds[c][e].css({display:""})},applyCssEnd:function(a,e,d){a&&(a in b.boxFxSeeds&&e in b.boxFxSeeds[a])&&d&&(b.addCssUnit(d),b.boxFxSeeds[a][e].crossCss(d))},applyClssEnd:function(c,e){c&&(c in b.boxFxSeeds&&
e in b.boxFxSeeds[c])&&(a.clss&&b.boxFxSeeds[c][e].removeClass(a.clss),a.transition&&a.transition.clssTo&&b.boxFxSeeds[c][e].addClass(a.transition.clssTo))},fireEndStyles:function(b){j.applyCssEnd(b.name,b.index,b.cssEnd);var e=a.transition?parseInt(a.transition.duration,10):0;0<a.animationOutroDuration&&0<e?setTimeout(function(a){j.applyClssEnd(a.name,a.index)},e-a.animationOutroDuration,b):j.applyClssEnd(b.name,b.index)}},u=function(){if(x){f=-1;for(var c=0;c<a.maxSeeds;c++)if(!b.boxFxSeeds[d][c]||
!b.data(b.boxFxSeeds[d][c],"inUse")){f=c;break}i&&(10>a.maxSeeds&&0<a.delay)&&console.log("addSeed() - S.index",f);if(0<=f){g=j.getCssStart();h=j.getCssEnd(g);a.styles&&b.each(a.styles,function(b,c){c&&"function"==typeof c&&(g[b]=a.styles[b].call(f))});a.transition&&a.transition.stylesTo&&b.each(a.transition.stylesTo,function(b,c){c&&"function"==typeof c&&(h[b]=a.transition.stylesTo[b].call(f))});switch(a.effect){case "center":g.left=a.emitterCenterLeft;g.top=a.emitterCenterTop;g.marginLeft=-(g.width/
2)+b.getRand(-a.emitterRadius,a.emitterRadius);g.marginTop=-(g.height/2)+b.getRand(-a.emitterRadius,a.emitterRadius);h.marginLeft=-h.width/2;h.marginTop=-h.height/2;break;case "artifice":g.left=a.emitterCenterLeft;g.top=a.emitterCenterTop;g.marginLeft=-(parseInt(g.width,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);g.marginTop=-(parseInt(g.height,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);p=-a.emitterCenterLeft;q=-a.emitterCenterTop;r=l-a.emitterCenterLeft-parseInt(h.width,10);s=o-a.emitterCenterTop-
parseInt(h.height,10);0.5<Math.random()?(h.marginLeft=b.getRand(p,r),h.marginTop=0.5>Math.random()?q:s):(h.marginLeft=0.5>Math.random()?p:r,h.marginTop=b.getRand(q,s));break;case "nebula":g.left=a.emitterCenterLeft,g.top=a.emitterCenterTop,g.marginLeft=-(g.width/2)+b.getRand(-a.emitterRadius,a.emitterRadius),g.marginTop=-(g.height/2)+b.getRand(-a.emitterRadius,a.emitterRadius),p=-a.emitterCenterLeft-h.width,q=-a.emitterCenterTop-h.height,r=l-a.emitterCenterLeft,s=o-a.emitterCenterTop,0.5<Math.random()?
(h.marginLeft=b.getRand(p,r),h.marginTop=0.5>Math.random()?q:s):(h.marginLeft=0.5>Math.random()?p:r,h.marginTop=b.getRand(q,s))}if(!b.boxFxSeeds[d][f]||1>b.boxFxSeeds[d][f].length)b.boxFxSeeds[d][f]=b(a.seeds);if(t=a.template?a.template:b.data(b.boxFxSeeds[d][f],"template"))"function"==typeof a.data?b.when(a.data({seed:b.boxFxSeeds[d][f],template:t})).done(function(a,c){a.seed.html(b.getTpl(a.template,c))}):(a.data&&a.data.length&&(A=a.data[w],w<a.data.length-1?w++:w=0),t=A?b.getTpl(t,A):t,b.boxFxSeeds[d][f].html(t));
c={name:d,index:f,cssEnd:h};b.boxFxSeeds[d][f].bind(b.animationStart,c,function(a){a.data.name&&(a.data.name in b.boxFxSeeds&&a.data.index in b.boxFxSeeds[a.data.name])&&(a=b.boxFxSeeds[a.data.name][a.data.index],a.unbind(b.animationStart),b.data(a,"isAnimated",1))});b.boxFxSeeds[d][f].bind(b.animationEnd,c,function(c){c.data.name&&(c.data.name in b.boxFxSeeds&&c.data.index in b.boxFxSeeds[c.data.name])&&(c=b.boxFxSeeds[c.data.name][c.data.index],c.unbind(b.animationEnd),b.data(c,"isAnimated",0),
(0<a.animationIntroDuration||!a.keyframes||!a.transition&&a.keyframes)&&c.trigger(b.transitionEnd))});b.boxFxSeeds[d][f].bind(b.transitionEnd,c,function(c){if(c.data.name&&c.data.name in b.boxFxSeeds&&c.data.index in b.boxFxSeeds[c.data.name]){var d=b.boxFxSeeds[c.data.name][c.data.index];if(!(0<a.animationIntroDuration)&&a.keyframes||!b.data(d,"isAnimated"))j.fireEndStyles(c.data),d.unbind(b.transitionEnd),a.stopAtEnd?"detach"==a.stopAtEnd&&(d.detach().attr("style",""),a.transition&&a.transition.clssTo&&
d.removeClass(a.transition.clssTo),a.animationsClss&&d.removeClass(a.animationsClss)):setTimeout(function(c){b.data(c,"inUse",0);c.detach().attr("style","");a.transition&&a.transition.clssTo&&c.removeClass(a.transition.clssTo);a.animationsClss&&c.removeClass(a.animationsClss)},0,d)}});j.applyCssStart(d,f,g);b.boxFxSeeds[d][f].appendTo(k);b.data(b.boxFxSeeds[d][f],"inUse",1);k.trigger("emit",[b.boxFxSeeds[d][f]]);(1>a.animationIntroDuration||a.keyframes)&&setTimeout(function(a){j.fireEndStyles(a)},
0,c)}A=t=s=r=q=p=h=g=f=void 0;a.stopAtEnd&&f==a.maxSeeds-1||(1<=a.delay?(m&&clearTimeout(m),m=setTimeout(u,a.delay)):C.requestAnimFrame(u))}};k.bind(v);k.trigger("start");return k})}})(jQuery,Modernizr,window);