//////////////////////////////////////////////////////////////////////////////////////////
// jQuery.boxFx.js (Beta V0.94) is like a "DOM particles emitter" factory
// "Clash the DOM with the most optimized jQuery animations framework on earth" ^^
// GPL/MIT/Copyleft @molokoloco 28/10/2011 - http://b2bweb.fr
// Sources : https://github.com/molokoloco/jQuery.boxFx/
// Download : https://github.com/molokoloco/jQuery.boxFx/downloads/
/////////////////////////////////////////////////////////////////////////////////////////

(function(b,c){"object"!=typeof Modernizr&&alert('$.fn.boxFx require "./js/modernizr(.min).js"');b.toolsLoaded||alert('$.fn.boxFx require "./js/jquery.tools.js"');Modernizr.csstransitions||db("Sad, your cheap browser don't support CSS transition");Modernizr.csstransforms3d||db("Sad, your computer don't support CSS 3D");b.boxFxOptions={seeds:"<div/>",targets:null,data:null,styles2Class:!0,clss:null,effect:null,emitterRadius:0,emitterCenterLeft:null,emitterCenterTop:null,delay:null,maxSeeds:null,newAtTop:"random",
stopAtEnd:!1,styles:null,transition:null,keyframes:null};b.boxFxOptions.defaultStyles={position:"absolute",display:"block",zIndex:500,width:50,height:50,backgroundColor:"rgb(255, 255, 0)"};b.boxFxOptions.defaultTransition={properties:"all",duration:"2500ms",timingFunction:"ease",stylesTo:null};b.boxFxOptions.defaultKeyframes=[{name:null,duration:"3000ms",timingFunction:"ease",delay:0,iterationCount:"infinite",direction:"alternate",fillMode:"both",steps:[]}];b.fn.boxFx=function(a){a=b.extend(!0,{},
b.boxFxOptions,a);return this.each(function(){var k=b(this),d,w,u,v,j,x,y,l,n,e,g,h,o,p,q,r,s,z,t={start:function(){m.initFx();m.configSetupFix();t.play()},play:function(){setTimeout(function(){if(a.keyframes)for(var b=c[d].length;b--;)c[d][b]&&0<c[d][b].length&&c[d][b].crossCss({animationPlayState:"running"});w=!0;t.newSeed()},0)},newSeed:function(){A()},pause:function(){if(a.keyframes)for(var b=c[d].length;b--;)c[d][b]&&0<c[d][b].length&&c[d][b].crossCss({animationPlayState:"paused"})},stop:function(){w=
!1;u&&clearTimeout(u);u=null;t.pause()},reset:function(){t.stop();for(var f=c[d].length;f--;)a.targets?(c[d][f].html(b.data(c[d][f],"template")).removeData(),b.contains(c[d][f],k)||c[d][f].appendTo(k)):c[d][f]&&0<c[d][f].length&&c[d][f].empty().remove(),delete c[d][f];delete c[d]},update:function(f,c){c&&!b.isEmptyObject(c)&&(a=b.extend(!0,{},a,c),m.configSetupFix())},setOptions:function(c,d){d&&!b.isEmptyObject(d)&&(t.reset(),setTimeout(function(){a=b.extend(!0,{},b.boxFxOptions,d);t.start()},0))},
getSeeds:function(){return c[d]}},m={initFx:function(){d=void 0;w=void 0;u=void 0;v=void 0;j=void 0;x=void 0;y=void 0;l=void 0;n=void 0;e=void 0;g=void 0;h=void 0;o=void 0;p=void 0;q=void 0;r=void 0;s=void 0;z=void 0;w=!0;u=null;d=b.getUniqueName("boxFx");v=0;j=null;y=x=0;c[d]=[];a.targets&&b(a.targets).each(function(f){c[d][f]=b(this).detach();!a.template&&a.data&&(b.data(c[d][f],"template",c[d][f].html()),c[d][f].html(""))})},configSetupFix:function(){l=parseInt(k.width(),10);n=parseInt(k.height(),
10);if(a.keyframes)b.each(a.keyframes,function(c,i){b.each(i.steps,function(i,f){b.each(f,function(b,f){"function"==typeof f&&(a.keyframes[c].steps[i][b]=a.keyframes[c].steps[i][b]())})})}),a.keyframes=b.extend(!0,{},a.defaultKeyframes,a.keyframes),a.animationsClss=b.buildKeyframeClass(a.keyframes);if(a.seeds&&!a.template&&a.data)a.template=b(a.seeds).html(),b(a.seeds).html("");if(!a.styles&&!a.clss)a.styles=b.extend({},a.defaultStyles);a.styles&&b.removeObjEmptyValue(a.styles);if(!a.clss&&a.seeds)a.clss=
b(a.seeds).attr("class");else if(!a.clss)a.clss=b(a.targets).eq(0).attr("class");if(a.effect){if(!a.styles)a.styles={};if(!a.styles.zIndex&&0!==a.styles.zIndex)a.styles.zIndex=a.defaultStyles.zIndex;if(!a.styles.position)a.styles.position="absolute";if(!a.styles.width&&!a.targets){var c=b(a.seed).css(a.styles).addClass(a.clss).appendTo(k);a.styles.width=c.width();c.remove()}}if(a.effect&&!a.transition)a.transition={};if(a.transition){a.transition=b.extend(!0,{},a.defaultTransition,a.transition);if(!a.transition||
!a.transition.stylesTo)a.transition.stylesTo={};a.transition.stylesTo.transition=a.transition.properties+" "+a.transition.duration+" "+a.transition.timingFunction}if(a.transition&&!a.effect&&!a.maxSeeds)a.stopAtEnd=!0;a.transition&&a.transition.duration&&(x=b.getMsDuration(a.transition.duration));a.keyframes&&a.keyframes[0].duration&&(y=b.getMsDuration(a.keyframes[0].duration));if(!a.delay&&0!==a.delay)a.delay=x>y?x:y;a.animationIntroDuration=0;a.animationOutroDuration=0;if(a.clss){c=b("<div/>").addClass(a.clss).appendTo("body");
a.animationIntroDuration=b.getMsDuration(c.css("-"+b.browserPrefix+"-animation-duration"));if(a.transition&&a.transition.clssTo)c.removeClass(a.clss).addClass(a.transition.clssTo),a.animationOutroDuration=b.getMsDuration(c.css("-"+b.browserPrefix+"-animation-duration"));c.remove()}if(a.targets)j=b(a.targets).hide(),a.maxSeeds=j.length;else if(!a.maxSeeds&&a.data&&"function"!=typeof a.data&&a.data.length)a.maxSeeds=a.data.length;else if(!a.maxSeeds&&a.transition)a.maxSeeds=1>a.delay?parseFloat(a.transition.duration):
parseFloat(a.transition.duration)/a.delay;if(!a.maxSeeds||1>a.maxSeeds)a.maxSeeds=1;else if(1E3<a.maxSeeds)a.maxSeeds=1E3;a.styles&&b.fixCssUnit(a.styles,l,n);a.transition&&a.transition.stylesTo&&b.fixCssUnit(a.transition.stylesTo,l,n);if(a.emitterRadius)a.emitterRadius=b.getSize(a.emitterRadius,l);a.emitterCenterLeft=!a.emitterCenterLeft&&0!==a.emitterCenterLeft?l/2:b.getSize(a.emitterCenterLeft,l);a.emitterCenterTop=!a.emitterCenterTop&&0!==a.emitterCenterTop?n/2:b.getSize(a.emitterCenterTop,n)},
getCssStart:function(){if(j&&0<j.length){if(!a.styles.width&&0!==a.styles.width)a.styles.width=parseInt(j.eq(e||0).width(),10);if(!a.styles.height&&0!==a.styles.height)a.styles.height=parseInt(j.eq(e||0).height(),10)}if(!a.effect&&a.styles)return b.extend({},a.styles);if(!a.styles.width&&0!==a.styles.width)db("Config. error, need at least options.styles.width to be setted"),a.styles.width=a.styles.height=0;var c,d,i;c=a.styles.maxSize||0===a.styles.maxSize?b.getRand(a.styles.width,a.styles.maxSize):
a.styles.width;d=a.styles.height||0===a.styles.height?a.styles.maxSize||0===a.styles.maxSize?b.getRand(a.styles.height,a.styles.maxSize):a.styles.height:c;i="random"==a.newAtTop?b.getRand(a.styles.zIndex,a.styles.zIndex+a.maxSeeds):a.newAtTop?a.styles.zIndex++:a.styles.zIndex--;return b.extend({},a.styles,{zIndex:i,width:c,height:d})},getCssEnd:function(c){if(!a.transition||!a.transition.stylesTo)return{};if(!a.effect)return b.extend({},a.transition.stylesTo);var d;d=c.width;c=c.height;if(a.transition.stylesTo.width||
0===a.transition.stylesTo.width)c=d=a.transition.stylesTo.maxSize||0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.width,a.transition.stylesTo.maxSize):a.transition.stylesTo.width;if(a.transition.stylesTo.height||0===a.transition.stylesTo.height)c=a.transition.stylesTo.maxSize||0===a.transition.stylesTo.maxSize?b.getRand(a.transition.stylesTo.height,a.transition.stylesTo.maxSize):a.transition.stylesTo.height;return b.extend({},a.transition.stylesTo,{width:d,height:c})},applyCssStart:function(d,
e,i){i&&(b.addCssUnit(i),c[d][e].crossCss(i));a.clss&&c[d][e].addClass(a.clss);a.animationsClss&&c[d][e].crossCss(a.animationsClss);"none"==c[d][e].css("display")&&c[d][e].css({display:""})},applyCssEnd:function(a,d,i){a&&a in c&&d in c[a]&&i&&(b.addCssUnit(i),c[a][d].crossCss(i))},applyClssEnd:function(b,d){b&&b in c&&d in c[b]&&(a.clss&&c[b][d].removeClass(a.clss),a.transition&&a.transition.clssTo&&c[b][d].addClass(a.transition.clssTo))}},A=function(){if(w){e=-1;for(var f=0;f<a.maxSeeds;f++)if(!c[d][f]||
!b.data(c[d][f],"inUse")){e=f;break}if(0<=e){g=m.getCssStart();h=m.getCssEnd(g);a.styles&&b.each(a.styles,function(b,c){c&&"function"==typeof c&&(g[b]=a.styles[b](e))});a.transition&&a.transition.stylesTo&&b.each(a.transition.stylesTo,function(b,c){c&&"function"==typeof c&&(h[b]=a.transition.stylesTo[b](e))});switch(a.effect){case "center":g.left=a.emitterCenterLeft;g.top=a.emitterCenterTop;g.marginLeft=-(g.width/2)+b.getRand(-a.emitterRadius,a.emitterRadius);g.marginTop=-(g.height/2)+b.getRand(-a.emitterRadius,
a.emitterRadius);h.marginLeft=-h.width/2;h.marginTop=-h.height/2;break;case "artifice":g.left=a.emitterCenterLeft;g.top=a.emitterCenterTop;g.marginLeft=-(parseInt(g.width,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);g.marginTop=-(parseInt(g.height,10)/2)+b.getRand(-a.emitterRadius,a.emitterRadius);o=-a.emitterCenterLeft;p=-a.emitterCenterTop;q=l-a.emitterCenterLeft-parseInt(h.width,10);r=n-a.emitterCenterTop-parseInt(h.height,10);0.5<Math.random()?(h.marginLeft=b.getRand(o,q),h.marginTop=0.5>
Math.random()?p:r):(h.marginLeft=0.5>Math.random()?o:q,h.marginTop=b.getRand(p,r));break;case "nebula":g.left=a.emitterCenterLeft,g.top=a.emitterCenterTop,g.marginLeft=-(g.width/2)+b.getRand(-a.emitterRadius,a.emitterRadius),g.marginTop=-(g.height/2)+b.getRand(-a.emitterRadius,a.emitterRadius),o=-a.emitterCenterLeft-h.width,p=-a.emitterCenterTop-h.height,q=l-a.emitterCenterLeft,r=n-a.emitterCenterTop,0.5<Math.random()?(h.marginLeft=b.getRand(o,q),h.marginTop=0.5>Math.random()?p:r):(h.marginLeft=0.5>
Math.random()?o:q,h.marginTop=b.getRand(p,r))}if(!c[d][e]||1>c[d][e].length)c[d][e]=b(a.seeds);if(s=a.template?a.template:b.data(c[d][e],"template"))"function"==typeof a.data?b.when(a.data({seed:c[d][e],template:s})).done(function(a,c){a.seed.html(b.getTpl(a.template,c))}):(a.data&&a.data.length&&(z=a.data[v],v<a.data.length-1?v++:v=0),s=z?b.getTpl(s,z):s,c[d][e].html(s));var f={name:d,index:e,cssEnd:h},j=function(b){m.applyCssEnd(b.name,b.index,b.cssEnd);var c=a.transition?parseInt(a.transition.duration,
10):0;0<a.animationOutroDuration&&0<c?setTimeout(function(a){m.applyClssEnd(a.name,a.index)},c-a.animationOutroDuration,b):m.applyClssEnd(b.name,b.index)};c[d][e].bind(b.animationStart,f,function(a){a.data.name&&a.data.name in c&&a.data.index in c[a.data.name]&&(a=c[a.data.name][a.data.index],a.unbind(b.animationStart),b.data(a,"isAnimated",1))});c[d][e].bind(b.animationEnd,f,function(d){d.data.name&&d.data.name in c&&d.data.index in c[d.data.name]&&(d=c[d.data.name][d.data.index],d.unbind(b.animationEnd),
b.data(d,"isAnimated",0),(0<a.animationIntroDuration||!a.keyframes)&&d.trigger(b.transitionEnd))});c[d][e].bind(b.transitionEnd,f,function(d){if(d.data.name&&d.data.name in c&&d.data.index in c[d.data.name]){var e=c[d.data.name][d.data.index];if(!(0<a.animationIntroDuration)&&a.keyframes||!b.data(e,"isAnimated"))j(d.data),e.unbind(b.transitionEnd),a.stopAtEnd||(b.data(e,"inUse",0),e.detach().attr("style",""),a.transition.clssTo&&e.removeClass(a.transition.clssTo),a.animationsClss&&e.removeClass(a.animationsClss))}});
m.applyCssStart(d,e,g);c[d][e].appendTo(k);b.data(c[d][e],"inUse",1);k.trigger("emit",[c[d][e]]);(1>a.animationIntroDuration||a.keyframes)&&setTimeout(function(a){j(a)},0,f)}a.stopAtEnd&&e==a.maxSeeds-1||(e=void 0,g=void 0,h=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,z=void 0,a.delay?u=setTimeout(A,a.delay):c.requestAnimFrame(A))}};k.bind(t);k.trigger("start");return k})}})(jQuery,window);